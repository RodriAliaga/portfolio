---
import BaseLayout from '@layouts/BaseLayout.astro';
import { profile } from '@data/profile';
import { cv } from '@data/cv';
import { getDict, type Lang, LANGS } from '@i18n/util';

export function getStaticPaths() {
  return LANGS.map((lang) => ({ params: { lang } }));
}
const { lang } = Astro.params as { lang: Lang };
const t = getDict(lang);
---
<BaseLayout title={t.experience.title} description={t.experience.intro(profile.name)} lang={lang}>
  <article class="space-y-6">
    <header>
      <h1 class="text-2xl font-semibold tracking-tight">{t.experience.h1}</h1>
      <p class="mt-2 text-muted">{t.experience.intro(profile.name)}</p>
      <div class="mt-4 flex flex-wrap gap-3">
        <a class="btn" href={profile.cv.es} download>Descargar CV (ES)</a>
        <a class="btn-outline" href={profile.cv.en} download>Download CV (EN)</a>
        <a class="btn-outline" href={profile.cv.alt} download>CV (Alt)</a>
      </div>
    </header>

    <section class="card p-4">
      <h2 class="font-semibold">{t.experience.preview.h}</h2>
      <p class="mt-2 text-sm text-muted">{t.experience.preview.p}</p>
      <div class="mt-4">
        <a class="btn-outline" href={profile.cv.es} target="_blank" rel="noreferrer">{t.experience.preview.open}</a>
      </div>
      <div class="mt-4 aspect-[3/4] w-full overflow-hidden rounded-lg border border-border bg-card">
        <object data={profile.cv.es} type="application/pdf" class="h-full w-full">
          <p class="p-4 text-sm text-muted">{t.experience.preview.open}</p>
        </object>
      </div>
    </section>

    {cv.summary && (
      <section class="space-y-2">
        <h2 class="text-xl font-semibold tracking-tight">{t.experience.sections.summary}</h2>
        <p class="text-muted">{cv.summary}</p>
      </section>
    )}

    {(cv.experience?.length > 0) && (
      <section class="space-y-4">
        <h2 class="text-xl font-semibold tracking-tight">{t.experience.sections.experience}</h2>
        <ul class="space-y-4">
          {cv.experience.map((item) => (
            <li class="card p-5">
              <div class="flex flex-col gap-1 sm:flex-row sm:items-baseline sm:justify-between">
                <h3 class="font-semibold">{item.role} · {item.company}</h3>
                <span class="text-sm text-muted">{item.period}</span>
              </div>
              {item.bullets?.length > 0 && (
                <ul class="mt-2 list-disc pl-5 text-sm text-muted">
                  {item.bullets.map((b) => (<li>{b}</li>))}
                </ul>
              )}
            </li>
          ))}
        </ul>
      </section>
    )}

    {((cv.skills.frontend.length + cv.skills.backend.length + cv.skills.devops.length + cv.skills.tools.length) > 0) && (
      <section class="space-y-3">
        <h2 class="text-xl font-semibold tracking-tight">{t.experience.sections.skills}</h2>
        <div class="grid gap-3 sm:grid-cols-2">
          {cv.skills.frontend.length > 0 && (
            <div class="card p-4">
              <h3 class="font-semibold">{t.experience.sections.frontend}</h3>
              <p class="mt-1 text-sm text-muted">{cv.skills.frontend.join(', ')}</p>
            </div>
          )}
          {cv.skills.backend.length > 0 && (
            <div class="card p-4">
              <h3 class="font-semibold">{t.experience.sections.backend}</h3>
              <p class="mt-1 text-sm text-muted">{cv.skills.backend.join(', ')}</p>
            </div>
          )}
          {cv.skills.devops.length > 0 && (
            <div class="card p-4">
              <h3 class="font-semibold">{t.experience.sections.devops}</h3>
              <p class="mt-1 text-sm text-muted">{cv.skills.devops.join(', ')}</p>
            </div>
          )}
          {cv.skills.tools.length > 0 && (
            <div class="card p-4">
              <h3 class="font-semibold">{t.experience.sections.tools}</h3>
              <p class="mt-1 text-sm text-muted">{cv.skills.tools.join(', ')}</p>
            </div>
          )}
        </div>
      </section>
    )}

    {(cv.education.length > 0) && (
      <section class="space-y-2">
        <h2 class="text-xl font-semibold tracking-tight">{t.experience.sections.education}</h2>
        <ul class="space-y-2 text-sm text-muted">
          {cv.education.map((e) => (
            <li>• {e.degree} · {e.institution} {e.year ? `· ${e.year}` : ''}</li>
          ))}
        </ul>
      </section>
    )}

    {(cv.languages.length > 0) && (
      <section class="space-y-2">
        <h2 class="text-xl font-semibold tracking-tight">{t.experience.sections.languages}</h2>
        <ul class="space-y-1 text-sm text-muted">
          {cv.languages.map((l) => (
            <li>• {l.name} — {l.level}</li>
          ))}
        </ul>
      </section>
    )}
  </article>
</BaseLayout>

